DROP TABLE IF EXISTS y_character_items;

DROP TABLE IF EXISTS y_characters;

DROP TABLE IF EXISTS y_items;

DROP TABLE IF EXISTS y_jobs;

-- アイテムのマスタテーブル
CREATE TABLE y_items (item_id INTEGER PRIMARY KEY, name VARCHAR(32) NOT NULL UNIQUE);

INSERT INTO
  y_items (item_id, name)
VALUES
  (1, 'Potion'),
  (2, 'Map'),
  (3, 'Compass'),
  (4, 'Rope'),
  (5, 'Knife');

-- ジョブ（職業）のマスタテーブル
CREATE TABLE y_jobs (
  job_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(16) NOT NULL UNIQUE
);

INSERT INTO
  y_jobs (job_id, name)
VALUES
  (1, 'Fighter'),
  (2, 'Monk'),
  (3, 'Ninja'),
  (4, 'Samurai'),
  (5, 'Priest'),
  (6, 'Wizard');

-- キャラクタのマスタテーブル
CREATE TABLE y_characters (
  character_id INTEGER PRIMARY KEY,
  name VARCHAR(16) NOT NULL,
  job_id INTEGER NOT NULL REFERENCES y_jobs (job_id),
  deleted_at TIMESTAMP
);

INSERT INTO
  y_characters (character_id, name, job_id)
VALUES
  (1, 'Marvin', 5),
  (2, 'Zach', 3),
  (3, 'Charlie', 6),
  (4, 'Tom', 1),
  (5, 'Alice', 5),
  (6, 'Oscar', 1);

-- キャラクタが所持するアイテムと数量を管理する中間テーブル
CREATE TABLE y_character_items (
  character_id INTEGER REFERENCES y_characters (character_id) ON DELETE CASCADE,
  item_id INTEGER REFERENCES y_items (item_id),
  qty INTEGER NOT NULL CHECK (qty >= 0),
  PRIMARY KEY (character_id, item_id)
);

INSERT INTO
  y_character_items (character_id, item_id, qty)
VALUES
  (1, 1, 3), -- Marvin, Potion,  3
  (5, 1, 2), -- Alice,  Potion,  2
  (5, 2, 1), -- Alice,  Map,     1
  (1, 3, 1), -- Marvin, Compass, 1
  (2, 3, 3), -- Zach,   Compass, 3
  (4, 1, 2), -- Tom,    Potion,  2
  (5, 5, 2) --  Alice,  Knife,   1
;

-- キャラクタを論理削除
UPDATE y_characters
SET
  deleted_at = '2025-12-31 07:10:00'
WHERE
  name = 'Zach' OR
  name = 'Alice';
